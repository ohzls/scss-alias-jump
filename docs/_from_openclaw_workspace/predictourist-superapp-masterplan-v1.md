# Predictourist Super-App Masterplan v1 (고3 정책 초안)

작성일: 2026-02-16  
작성자: MacM4Pro

---

## 0. 문서 목적
이 문서는 다음을 한 번에 정의한다.

1. **3개 서비스 통합 전략**
   - 관광지 혼잡도 예측/가이드
   - 이동 동선 기반 휴먼택배 매칭
   - OTT 공동구매/정산(약관 허용 범위 내)
2. **공통 계정·신뢰점수·개인화 테마/접근성**
3. **현재 코드/인프라 상태(AS-IS) vs 목표 상태(TO-BE)**
4. **추가 개발/고도화 우선순위**
5. **Firebase/GCS 이후 확장 이전 전략**
   - 언제, 무엇을, 어떤 비용 기준으로 옮길지

> 원칙: 시간대별 작업표는 제외. 대신 단계별 게이트와 수치 기준을 고3(단계1/2/3) 방식으로 명확히 둔다.

---

## 1. 북극성(북극 KPI)

### 1.1 제품 북극성
- “사용자의 **실제 이동/방문/거래**를 데이터로 연결해 개인화된 도시 생활 네트워크를 만든다.”

### 1.2 핵심 KPI
- MAU / WAU
- 관광 질의 성공률(근거 포함 응답 비율)
- 일정 등록→완료 전환율
- 휴먼택배 매칭성공률 / SLA 준수율
- OTT 그룹 유지율(월 단위)
- 분쟁 발생률/환불률
- 신뢰점수 기반 제재율(악성 행동 억제)

---

## 2. 서비스 구조 (3축 + 2공통)

## 2.1 서비스 A: 관광지 혼잡도 예측 (Acquisition/Funnel Top)
- 역할: 유입, 검색, 반복 방문 트리거
- 기능:
  - 혼잡도 예측
  - 추천 시간대
  - 위치/출처/근거 정보
  - RAG 기반 상세 맥락(기사/공공데이터/이벤트)

## 2.2 서비스 B: 휴먼택배 (Transaction)
- 역할: 거래/수익화
- 기능:
  - 출발지/목적지/시간/무게 입력
  - 동선 기반 공급자 매칭
  - 알림/확정/완료/정산
  - 분쟁/보상

## 2.3 서비스 C: OTT 공동구매/정산 (Retention)
- 역할: 잔존, 구독형 수익
- 전제:
  - 서비스별 약관 허용 범위 확인 필수
  - 불허 서비스는 취급 금지
- 기능:
  - 그룹 생성/참여
  - 월 분담금 자동 정산
  - 미납 처리/대체 인원 매칭

## 2.4 공통 요소 D: 신뢰점수
- 세 서비스 공통 품질/리스크 제어 레이어
- 신호:
  - + 일정 실제 완료, 배송 성실 완료, 분쟁 없음
  - - 노쇼, 지연 반복, 허위 제보, 미납, 분쟁 패소
- 활용:
  - 매칭 우선순위
  - 보증금/선결제 요구 수준
  - 고위험 사용자 제한

## 2.5 공통 요소 E: 개인화 테마/접근성 프로필
- 기기 교체/다중 디바이스에서도 동일 경험 유지
- 저장 항목 예시:
  - fontScale, colorTheme, contrastMode, motionReduce, spacingDensity, language
- 3개 앱 공통 토큰 사용 (Design Token System)

---

## 3. 현재 상태 요약 (AS-IS)

### 3.1 채팅/백엔드
- `/api/chat` 경로 동작 중
- OpenClaw/qwen 엔진 스위치 가능한 구조
- 관광 외 질의 고정 응답 가드 추가됨
- 모델/버전 질의 고정 응답 규칙 반영됨
- 로그 저장 강화:
  - request/session/query/reply/rag/source/user_id/ip 저장 가능

### 3.2 프론트
- 타이핑 효과 복구
- NFT 테스트 모달 임시 비활성화
- 방문 완료는 단순 컨펌 후 처리 방식 반영

### 3.3 약관/동의
- 서비스 약관에 채팅/IP/UID 수집 항목 반영 시작
- terms version 상향 반영됨

### 3.4 미완료/갭
- Google 로그인 UID가 실제 실서버 요청에서 안정적으로 들어오는지 추가 모니터링 필요
- OTT 서비스는 컴플라이언스 검토 전이라 사업 리스크 높음
- 휴먼택배는 아직 정식 도메인 모델/정산 모델 미구현

---

## 4. 목표 구조 (TO-BE)

## 4.1 공통 계정
- Identity: Google UID 기반
- 권한: 사용자/검증자/운영자/어드민
- 감사: 행동 로그 및 동의 이력 버저닝

## 4.2 데이터 레이어
- User Profile
- Trust Score
- Mobility Intent (이동 계획)
- Delivery Order / Match / Settlement
- OTT Group / Billing / Membership
- RAG Source / Evidence / Version

## 4.3 운영 레이어
- 자동화(크롤링/검증/알림)
- 인입 검증(허위 제보 필터)
- 분쟁 처리 큐
- 보상/패널티 엔진

---

## 5. 고3 정책 기반 개발 게이트 (단계1/2/3)

## 단계1: 핵심 정책·데이터 안전성
PASS 기준:
- 비관광 질의 차단 규칙 3회 연속 PASS
- 모델/버전 고정 응답 규칙 3회 연속 PASS
- user_id/ip/query/reply 로그 저장 3회 연속 PASS
- 약관 버전/동의 이력 저장 3회 연속 PASS

실패 시:
- 단계1 카운트 0/3 리셋

## 단계2: 서비스 통합 최소 기능
PASS 기준:
- 메인 검색→챗봇 직행 UX 3회 PASS
- 상단 요약카드+출처+RAG 리스트 렌더 3회 PASS
- 휴먼택배 MVP(등록→매칭 시뮬→완료) 3회 PASS
- 신뢰점수 업데이트 반영 3회 PASS

실패 시:
- 단계2 카운트 0/3 리셋 (단계1 유지)

## 단계3: 확장/운영 준비
PASS 기준:
- 동시요청/지연/오류율 기준 통과 3회 PASS
- 보상/패널티 룰 악용 테스트 통과 3회 PASS
- 운영 대시보드(분쟁/정산/알림) 점검 3회 PASS
- 비용·성능 임계치 모니터링 지표 확인 3회 PASS

실패 시:
- 단계3 카운트 0/3 리셋

---

## 6. 인프라 확장 로드맵 (Firebase/GCS → 차세대)

## 6.1 결론 먼저
- **초기~중기(활성 사용자 수천~수만 초입)**: Firebase/GCS 유지가 보통 유리
- **중기 이후(트래픽/쿼리 복잡도/로그 비용 급증)**: 부분 이전 시작
- **대규모(DAU 수만+, write/read 고밀도)**: 핵심 트랜잭션은 전용 DB/큐/분석 스택으로 분리

## 6.2 이전 타이밍 판단 기준 (권장)
다음 중 2개 이상 연속 2개월 초과 시 이전 검토:

1. 월 인프라 비용이 매출총이익의 20~30% 이상
2. Firestore 쿼리 비용 급증(특히 fan-out, 대량 스캔)
3. p95 응답시간 목표(예: 1.5s) 지속 미달
4. 운영자가 수동 정산/분쟁 처리에 월 80시간 이상 소모
5. 로그/분석 요구로 Firestore가 분석 워크로드를 감당 못함

## 6.3 권장 이전 순서 (빅뱅 금지)
1) **로그/분석 분리**
   - Firestore 운영데이터 유지
   - 이벤트 로그는 BigQuery/ClickHouse 계열 분리

2) **매칭/정산 트랜잭션 분리**
   - 휴먼택배 주문·매칭·정산을 Postgres(+Redis 큐)로 분리

3) **RAG 소스 인덱싱 분리**
   - 검색·벡터 인덱스를 전용 저장소로 분리

4) **계정/동의 이력 강화**
   - 법무 요구 대응 가능한 감사테이블 강화

## 6.4 규모별 권장 아키텍처
- Stage A (DAU < 10k): Firebase 중심 + Cloud Functions
- Stage B (DAU 10k~50k): Firebase + Postgres 혼합(핵심 트랜잭션 분리)
- Stage C (DAU 50k+): 서비스별 마이크로도메인 DB + 메시지큐 + 분석 파이프라인

## 6.5 비용/운영 밸런스 포인트
- 너무 빨리 이전하면: 운영복잡도/개발속도 급락
- 너무 늦게 이전하면: 비용 폭증/품질 저하/장애 복구 지연
- 권장: “지표 임계치 기반 점진 이전” (서비스 도메인별)

---

## 7. 법적/정책 체크포인트

1. 채팅/UID/IP 수집 고지의 명확성
2. 보관기간/파기절차 명시
3. 제3자 제공/국외 이전 여부 명시
4. 휴먼택배의 책임 경계/면책/분쟁 정책
5. OTT 서비스별 약관 적합성 (불허 모델 제외)

---

## 8. 바로 추가 개발해야 할 항목 (우선순위)

P0
- UID/IP 실서버 유입 모니터 대시보드
- 메인 검색→챗봇 직행 + 요약카드/출처/RAG 리스트
- 신뢰점수 v1 스키마 및 계산 배치

P1
- 휴먼택배 MVP (등록/매칭/완료/기초 정산)
- 제보→검증→보상 파이프라인
- 접근성/개인화 토큰 시스템

P2
- OTT 컴플라이언스 매트릭스 + 허용 서비스 한정 MVP
- 운영 콘솔(분쟁/정산/제재/보상)

---

## 9. 산출물(다음 버전 문서에서 추가)
- 상세 ERD
- API 명세
- 이벤트 스키마
- 운영 SOP
- 리스크 등록부
- KPI 대시보드 템플릿

---

## 10. 최종 한 줄 전략

**Predictourist는 ‘관광 데이터 앱’이 아니라, 공통 신뢰 인프라 위에서 관광·배송·구독을 연결하는 도시 생활 네트워크로 진화한다.**
